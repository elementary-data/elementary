elementary_tests:
  target: postgres
  outputs:

    # ── Docker targets (plaintext, no secrets needed) ──────────────────

    postgres: &postgres
      type: postgres
      host: 127.0.0.1
      port: 5432
      user: admin
      password: admin
      dbname: postgres
      schema: {{ schema_name }}
      threads: 32

    clickhouse: &clickhouse
      type: clickhouse
      host: localhost
      port: 8123
      user: default
      password: default
      schema: {{ schema_name }}
      threads: 4

    # ── Cloud targets (secrets substituted at CI time) ─────────────────

    snowflake: &snowflake
      type: snowflake
      account: {{ snowflake_account | toyaml }}
      user: {{ snowflake_user | toyaml }}
      password: {{ snowflake_password | toyaml }}
      role: {{ snowflake_role | toyaml }}
      database: {{ snowflake_database | toyaml }}
      warehouse: {{ snowflake_warehouse | toyaml }}
      schema: {{ schema_name }}
      threads: 4

    bigquery: &bigquery
      type: bigquery
      method: service-account-json
      project: {{ bigquery_project | toyaml }}
      dataset: {{ schema_name }}
      keyfile_json: {{ bigquery_keyfile | toyaml }}
      location: US
      priority: interactive
      threads: 4

    redshift: &redshift
      type: redshift
      host: {{ redshift_host | toyaml }}
      user: {{ redshift_user | toyaml }}
      password: {{ redshift_password | toyaml }}
      port: {{ redshift_port | toyaml }}
      dbname: {{ redshift_dbname | toyaml }}
      schema: {{ schema_name }}
      threads: 4

    databricks_catalog: &databricks_catalog
      type: databricks
      host: {{ databricks_host | toyaml }}
      http_path: {{ databricks_http_path | toyaml }}
      catalog: {{ databricks_catalog | toyaml }}
      schema: {{ schema_name }}
      auth_type: oauth
      client_id: {{ databricks_client_id | toyaml }}
      client_secret: {{ databricks_client_secret | toyaml }}
      threads: 4

    athena: &athena
      type: athena
      s3_staging_dir: {{ athena_s3_staging_dir | toyaml }}
      s3_data_dir: {{ athena_s3_data_dir | toyaml }}
      region_name: {{ athena_region | toyaml }}
      database: awsdatacatalog
      schema: {{ schema_name }}
      aws_access_key_id: {{ athena_aws_access_key_id | toyaml }}
      aws_secret_access_key: {{ athena_aws_secret_access_key | toyaml }}
      threads: 4

# The internal CLI dbt_project uses profile "elementary", so we alias the
# same targets but override the schema to <base>_elementary.
elementary:
  target: postgres
  outputs:
{%- set targets = ['postgres', 'clickhouse', 'snowflake', 'bigquery', 'redshift', 'databricks_catalog', 'athena'] %}
{%- for t in targets %}
    {{ t }}:
      <<: *{{ t }}
      {{ 'dataset' if t == 'bigquery' else 'schema' }}: {{ schema_name }}_elementary
{%- endfor %}
